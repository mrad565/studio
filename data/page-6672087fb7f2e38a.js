(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2751:(e,t,r)=>{Promise.resolve().then(r.bind(r,7684))},7481:(e,t,r)=>{"use strict";r.d(t,{dj:()=>m});var a=r(2115);let s=0,n=new Map,l=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?l(r):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],d={toasts:[]};function c(e){d=o(d,e),i.forEach(e=>{e(d)})}function u(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function m(){let[e,t]=a.useState(d);return a.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},7684:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>eq});var a=r(5155),s=r(2115),n=r(8681),l=r(8639),o=r(2087);function i(e){let{isConnected:t}=e;return(0,a.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-border/50 shadow-lg shadow-black/25",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(n.A,{className:"h-8 w-8 text-primary animate-pulse"}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-foreground font-headline tracking-wider",children:"Digital Water Curtain"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium ".concat(t?"bg-accent/20 text-accent":"bg-destructive/20 text-destructive"),children:[t?(0,a.jsx)(l.A,{className:"h-4 w-4"}):(0,a.jsx)(o.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:t?"Connected":"Not Connected"})]})]})}var d=r(221),c=r(2177),u=r(5594),m=r(4253),f=r(2085),x=r(9434);let p=(0,f.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),h=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:l=!1,...o}=e,i=l?m.DX:"button";return(0,a.jsx)(i,{className:(0,x.cn)(p({variant:s,size:n,className:r})),ref:t,...o})});h.displayName="Button";let g=s.forwardRef((e,t)=>{let{className:r,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:(0,x.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});g.displayName="Input";var b=r(64);let v=b.bL,j=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(b.B8,{ref:t,className:(0,x.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s})});j.displayName=b.B8.displayName;let N=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(b.l9,{ref:t,className:(0,x.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...s})});N.displayName=b.l9.displayName;let y=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(b.UC,{ref:t,className:(0,x.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s})});y.displayName=b.UC.displayName;let w=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("textarea",{className:(0,x.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...s})});w.displayName="Textarea";var C=r(7481),S=r(1008),A=r(9093),k=r(9311),E=r(7990),P=r(8763),F=r(172);let R=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,x.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});R.displayName="Card";let D=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,x.cn)("flex flex-col space-y-1.5 p-6",r),...s})});D.displayName="CardHeader";let M=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,x.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});M.displayName="CardTitle";let V=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,x.cn)("text-sm text-muted-foreground",r),...s})});V.displayName="CardDescription";let I=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,x.cn)("p-6 pt-0",r),...s})});I.displayName="CardContent";let T=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,x.cn)("flex items-center p-6 pt-0",r),...s})});T.displayName="CardFooter";var O=r(968);let z=(0,f.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),L=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(O.b,{ref:t,className:(0,x.cn)(z(),r),...s})});L.displayName=O.b.displayName;let U=c.Op,_=s.createContext({}),G=e=>{let{...t}=e;return(0,a.jsx)(_.Provider,{value:{name:t.name},children:(0,a.jsx)(c.xI,{...t})})},W=()=>{let e=s.useContext(_),t=s.useContext(q),{getFieldState:r,formState:a}=(0,c.xW)(),n=r(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=t;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...n}},q=s.createContext({}),B=s.forwardRef((e,t)=>{let{className:r,...n}=e,l=s.useId();return(0,a.jsx)(q.Provider,{value:{id:l},children:(0,a.jsx)("div",{ref:t,className:(0,x.cn)("space-y-2",r),...n})})});B.displayName="FormItem";let Y=s.forwardRef((e,t)=>{let{className:r,...s}=e,{error:n,formItemId:l}=W();return(0,a.jsx)(L,{ref:t,className:(0,x.cn)(n&&"text-destructive",r),htmlFor:l,...s})});Y.displayName="FormLabel";let J=s.forwardRef((e,t)=>{let{...r}=e,{error:s,formItemId:n,formDescriptionId:l,formMessageId:o}=W();return(0,a.jsx)(m.DX,{ref:t,id:n,"aria-describedby":s?"".concat(l," ").concat(o):"".concat(l),"aria-invalid":!!s,...r})});J.displayName="FormControl",s.forwardRef((e,t)=>{let{className:r,...s}=e,{formDescriptionId:n}=W();return(0,a.jsx)("p",{ref:t,id:n,className:(0,x.cn)("text-sm text-muted-foreground",r),...s})}).displayName="FormDescription";let H=s.forwardRef((e,t)=>{var r;let{className:s,children:n,...l}=e,{error:o,formMessageId:i}=W(),d=o?String(null!=(r=null==o?void 0:o.message)?r:""):n;return d?(0,a.jsx)("p",{ref:t,id:i,className:(0,x.cn)("text-sm font-medium text-destructive",s),...l,children:d}):null});H.displayName="FormMessage";var X=r(5668),Z=r(5318);let Q=X.bL;X.l9;let K=X.ZL;X.bm;let $=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(X.hJ,{ref:t,className:(0,x.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s})});$.displayName=X.hJ.displayName;let ee=s.forwardRef((e,t)=>{let{className:r,children:s,...n}=e;return(0,a.jsxs)(K,{children:[(0,a.jsx)($,{}),(0,a.jsxs)(X.UC,{ref:t,className:(0,x.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...n,children:[s,(0,a.jsxs)(X.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(Z.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});ee.displayName=X.UC.displayName;let et=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,x.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...r})};et.displayName="DialogHeader";let er=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,x.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})};er.displayName="DialogFooter";let ea=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(X.hE,{ref:t,className:(0,x.cn)("text-lg font-semibold leading-none tracking-tight",r),...s})});ea.displayName=X.hE.displayName;let es=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(X.VY,{ref:t,className:(0,x.cn)("text-sm text-muted-foreground",r),...s})});es.displayName=X.VY.displayName;var en=r(7655);let el=s.forwardRef((e,t)=>{let{className:r,children:s,...n}=e;return(0,a.jsxs)(en.bL,{ref:t,className:(0,x.cn)("relative overflow-hidden",r),...n,children:[(0,a.jsx)(en.LM,{className:"h-full w-full rounded-[inherit]",children:s}),(0,a.jsx)(eo,{}),(0,a.jsx)(en.OK,{})]})});el.displayName=en.bL.displayName;let eo=s.forwardRef((e,t)=>{let{className:r,orientation:s="vertical",...n}=e;return(0,a.jsx)(en.VM,{ref:t,orientation:s,className:(0,x.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...n,children:(0,a.jsx)(en.lr,{className:"relative flex-1 rounded-full bg-border"})})});eo.displayName=en.VM.displayName;var ei=r(7326),ed=r(9119);function ec(e){let{isOpen:t,setIsOpen:r,addPattern:n,initialNumValves:l}=e,[o,i]=(0,s.useState)("My Manual Pattern"),[d,c]=(0,s.useState)(16),[u,m]=(0,s.useState)(l),[f,x]=(0,s.useState)([]),{toast:p}=(0,C.dj)(),[b,v]=(0,s.useState)(!1),[j,N]=(0,s.useState)(null);(0,s.useEffect)(()=>{t&&(m(l),c(16),i("My Manual Pattern"))},[t,l]),(0,s.useEffect)(()=>{let e=Math.max(8,u);x(Array.from({length:Math.max(1,Math.min(d,100))},()=>Array(e).fill(!1)))},[d,u,t]),(0,s.useEffect)(()=>{let e=()=>{v(!1),N(null)};return window.addEventListener("mouseup",e),()=>{window.removeEventListener("mouseup",e)}},[]);let y=(e,t)=>{v(!0);let r=f.map(e=>[...e]),a=!r[e][t];r[e][t]=a,x(r),N(a?"draw":"erase")},w=(e,t)=>{if(!b||!j)return;let r=f.map(e=>[...e]),a="draw"===j;r[e][t]!==a&&(r[e][t]=a,x(r))},S=(0,s.useMemo)(()=>({gridTemplateColumns:"repeat(".concat(u,", minmax(0, 1fr))"),gridTemplateRows:"repeat(".concat(d,", minmax(0, 1fr))")}),[u,d]);return(0,a.jsx)(Q,{open:t,onOpenChange:r,children:(0,a.jsxs)(ee,{className:"max-w-4xl bg-background border-primary/30",children:[(0,a.jsxs)(et,{children:[(0,a.jsx)(ea,{className:"text-primary font-headline text-2xl",children:"Manual Pattern Editor"}),(0,a.jsx)(es,{children:"Click and drag to create your own pattern. Define the dimensions and give it a name."})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 py-4",children:[(0,a.jsxs)("div",{className:"md:col-span-1 flex flex-col gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(L,{htmlFor:"pattern-name",className:"text-muted-foreground",children:"Pattern Name"}),(0,a.jsx)(g,{id:"pattern-name",value:o,onChange:e=>i(e.target.value),className:"bg-card border-border"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(L,{htmlFor:"pattern-rows",className:"text-muted-foreground",children:"Rows (Time Steps)"}),(0,a.jsx)(g,{id:"pattern-rows",type:"number",value:d,onChange:e=>c(Math.min(Number(e.target.value),100)),min:"1",max:100,className:"bg-card border-border"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(L,{htmlFor:"pattern-cols",className:"text-muted-foreground",children:"Columns (Valves)"}),(0,a.jsx)(g,{id:"pattern-cols",type:"number",value:u,onChange:e=>m(Number(e.target.value)),min:"8",step:"8",className:"bg-card border-border"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 pt-4",children:[(0,a.jsxs)(h,{onClick:()=>{x(Array.from({length:d},()=>Array(u).fill(!1)))},variant:"outline",className:"border-accent text-accent hover:bg-accent/20 hover:text-accent",children:[(0,a.jsx)(ei.A,{className:"mr-2 h-4 w-4"}),"Clear Grid"]}),(0,a.jsxs)(h,{onClick:()=>{if(!o.trim())return void p({variant:"destructive",title:"Error",description:"Pattern name is required."});let e=Math.max(1,Math.min(d,100));if(e<1||u<8||u%8!=0)return void p({variant:"destructive",title:"Error",description:"Columns (valves) must be at least 8 and a multiple of 8."});n({name:o,patternData:f,source:"manual",promptOrFile:"".concat(e,"x").concat(u," grid")}),p({title:"Success",description:"Manual pattern saved!"}),r(!1)},className:"bg-accent hover:bg-accent/80 text-black font-bold",children:[(0,a.jsx)(ed.A,{className:"mr-2 h-4 w-4"}),"Save Pattern"]})]})]}),(0,a.jsx)("div",{className:"md:col-span-2 bg-card/50 rounded-lg p-2 border border-border aspect-video",children:(0,a.jsx)(el,{className:"w-full h-full",children:(0,a.jsx)("div",{className:"grid gap-px p-1",style:S,onMouseLeave:()=>v(!1),children:f.map((e,t)=>e.map((e,r)=>(0,a.jsx)("button",{onMouseDown:e=>{e.preventDefault(),y(t,r)},onMouseEnter:()=>w(t,r),className:"w-full aspect-square rounded-sm transition-colors ".concat(e?"bg-primary hover:bg-primary/80":"bg-background hover:bg-border"),"aria-label":"Cell ".concat(t,", ").concat(r)},"".concat(t,"-").concat(r))))})})})]}),(0,a.jsx)(er,{children:(0,a.jsx)(h,{onClick:()=>r(!1),variant:"ghost",children:"Close"})})]})})}function eu(e){let t=e.getContext("2d",{willReadFrequently:!0});if(!t)throw Error("Could not get canvas context");let r=t.getImageData(0,0,e.width,e.height).data,a=[];for(let t=0;t<e.height;t++){let s=[];for(let a=0;a<e.width;a++){let n=r[(t*e.width+a)*4+3];s.push(n>128)}a.push(s)}return a}let em=u.z.object({textPrompt:u.z.string().min(1,"Prompt cannot be empty."),numValves:u.z.coerce.number().int().min(8,"Must have at least 8 valves.").refine(e=>e%8==0,{message:"Number of valves must be a multiple of 8."})}),ef=u.z.object({image:u.z.any().refine(e=>(null==e?void 0:e.length)>0,"Image is required."),numValves:u.z.coerce.number().int().min(8,"Must have at least 8 valves.").refine(e=>e%8==0,{message:"Number of valves must be a multiple of 8."})}),ex=u.z.object({svg:u.z.any().refine(e=>(null==e?void 0:e.length)>0,"SVG file is required."),numValves:u.z.coerce.number().int().min(8,"Must have at least 8 valves.").refine(e=>e%8==0,{message:"Number of valves must be a multiple of 8."})});function ep(e){let{addPattern:t}=e,[r,n]=(0,s.useState)("text"),[l,o]=(0,s.useState)(!1),[i,u]=(0,s.useState)(!1),{toast:m}=(0,C.dj)(),f=(0,c.mN)({resolver:(0,d.u)(em),defaultValues:{textPrompt:"",numValves:16}}),x=(0,c.mN)({resolver:(0,d.u)(ef),defaultValues:{numValves:16}}),p=(0,c.mN)({resolver:(0,d.u)(ex),defaultValues:{numValves:16}}),b=async e=>{o(!0);try{var r,a;let s=await (r=e.textPrompt,a=e.numValves,new Promise((e,t)=>{let s=document.createElement("canvas"),n=s.getContext("2d");if(!n)return t(Error("Could not get canvas context"));n.font="".concat(a,'px "Inter"');let l=Math.min(a,(a-8)*a/n.measureText(r).width);n.font="".concat(l,'px "Inter"');let o=n.measureText(r),i=o.actualBoundingBoxAscent+o.actualBoundingBoxDescent;s.width=a,s.height=Math.ceil(i)+8,n.font="".concat(l,'px "Inter"'),n.textAlign="center",n.textBaseline="middle",n.fillStyle="black",n.fillText(r,s.width/2,s.height/2),e(eu(s))}));if(s&&s.length>0&&s[0].length>0)t({name:e.textPrompt.substring(0,30)+(e.textPrompt.length>30?"...":""),patternData:s,source:"text",promptOrFile:e.textPrompt}),m({title:"Success",description:"New text pattern generated!"}),f.reset({...e,textPrompt:""});else throw Error("Failed to generate pattern from text")}catch(e){console.error(e),m({variant:"destructive",title:"Error",description:e.message||"Failed to generate pattern from text."})}finally{o(!1)}},T=e=>new Promise((t,r)=>{let a=new FileReader;a.readAsText(e),a.onload=()=>t(a.result),a.onerror=e=>r(e)}),O=async e=>{o(!0);try{var r;let a=e.image[0],s=await (r=e.numValves,new Promise((e,t)=>{let s=new FileReader;s.onload=a=>{var s;if(!(null==(s=a.target)?void 0:s.result))return t(Error("Failed to read file"));let n=new Image;n.onload=()=>{let a=Math.max(1,Math.round(r*(n.height/n.width))),s=document.createElement("canvas");s.width=r,s.height=a;let l=s.getContext("2d");if(!l)return t(Error("Could not get canvas context"));l.drawImage(n,0,0,r,a),e(eu(s))},n.onerror=()=>t(Error("The selected image file could not be loaded. It may be corrupt or in an unsupported format.")),n.src=a.target.result},s.onerror=()=>t(Error("Failed to read the selected file.")),s.readAsDataURL(a)}));if(s)t({name:a.name,patternData:s,source:"image",promptOrFile:a.name}),m({title:"Success",description:"New image pattern generated!"}),x.reset({...e,image:null});else throw Error("Failed to process image")}catch(e){console.error(e),m({variant:"destructive",title:"Error",description:e.message||"Failed to generate pattern from image."})}finally{o(!1)}},z=async e=>{o(!0);try{var r;let a=e.svg[0],s=await T(a),n=await (r=e.numValves,new Promise((e,t)=>{try{let a,n=new DOMParser().parseFromString(s,"image/svg+xml").documentElement;if(n.querySelector("parsererror")||"html"===n.tagName.toLowerCase())return t(Error("Failed to parse SVG. The file might be corrupt or not a valid SVG."));let l=n.getAttribute("viewBox");if(l){let e=l.split(/[ ,]+/);if(4===e.length){let t=parseFloat(e[2]),r=parseFloat(e[3]);a=t>0&&r>0?r/t:1}else a=1}else{let e=n.getAttribute("width"),t=n.getAttribute("height");if(e&&t){let r=parseFloat(e),s=parseFloat(t);a=r>0&&s>0?s/r:1}else a=1}isNaN(a)&&(a=1);let o=Math.max(1,Math.round(r*a));n.setAttribute("width","".concat(r,"px")),n.setAttribute("height","".concat(o,"px")),n.setAttribute("preserveAspectRatio","none");let i=new XMLSerializer().serializeToString(n),d=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),c=URL.createObjectURL(d),u=new Image;u.onload=()=>{let a=document.createElement("canvas");a.width=r,a.height=o;let s=a.getContext("2d");if(!s)return URL.revokeObjectURL(c),t(Error("Could not get canvas context"));s.drawImage(u,0,0,r,o),URL.revokeObjectURL(c),e(eu(a))},u.onerror=()=>{URL.revokeObjectURL(c),t(Error("The selected SVG file could not be rendered. It may be corrupt or contain unsupported features."))},u.src=c}catch(e){e instanceof Error?t(e):t(Error("An unknown error occurred while processing the SVG."))}}));if(n)t({name:a.name,patternData:n,source:"svg",promptOrFile:a.name}),m({title:"Success",description:"New SVG pattern generated!"}),p.reset({...e,svg:null});else throw Error("Failed to process SVG")}catch(e){console.error(e),m({variant:"destructive",title:"Error generating from SVG",description:e.message||"Please check the file and try again."})}finally{o(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(R,{className:"bg-card border-border shadow-2xl shadow-black/25",children:[(0,a.jsxs)(D,{children:[(0,a.jsxs)(M,{className:"flex items-center gap-2 text-primary font-headline",children:[(0,a.jsx)(S.A,{className:"h-6 w-6"}),"Pattern Generator"]}),(0,a.jsx)(V,{children:"Create waterfall designs from text, images, SVGs, or from scratch."})]}),(0,a.jsx)(I,{children:(0,a.jsxs)(v,{value:r,onValueChange:n,className:"w-full",children:[(0,a.jsxs)(j,{className:"grid w-full grid-cols-4 bg-secondary",children:[(0,a.jsxs)(N,{value:"text",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-lg gap-2",children:[(0,a.jsx)(A.A,{})," Text"]}),(0,a.jsxs)(N,{value:"image",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-lg gap-2",children:[(0,a.jsx)(k.A,{})," Image"]}),(0,a.jsxs)(N,{value:"svg",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-lg gap-2",children:[(0,a.jsx)(E.A,{})," SVG"]}),(0,a.jsxs)(N,{value:"manual",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-lg gap-2",children:[(0,a.jsx)(P.A,{})," Manual"]})]}),(0,a.jsx)(y,{value:"text",className:"mt-6",children:(0,a.jsx)(U,{...f,children:(0,a.jsxs)("form",{onSubmit:f.handleSubmit(b),className:"space-y-6",children:[(0,a.jsx)(G,{control:f.control,name:"textPrompt",render:e=>{let{field:t}=e;return(0,a.jsxs)(B,{children:[(0,a.jsx)(Y,{className:"text-muted-foreground",children:"Text Prompt"}),(0,a.jsx)(J,{children:(0,a.jsx)(w,{placeholder:"e.g., Hello World, AquaGlyph...",...t,className:"bg-input border-border focus:ring-primary min-h-[100px]"})}),(0,a.jsx)(H,{})]})}}),(0,a.jsx)(G,{control:f.control,name:"numValves",render:e=>{let{field:t}=e;return(0,a.jsxs)(B,{children:[(0,a.jsx)(Y,{className:"text-muted-foreground",children:"Number of Valves"}),(0,a.jsx)(J,{children:(0,a.jsx)(g,{type:"number",...t,className:"bg-input border-border focus:ring-primary",step:"8"})}),(0,a.jsx)(H,{})]})}}),(0,a.jsx)(h,{type:"submit",disabled:l,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground font-bold text-lg py-6",children:l?(0,a.jsx)(F.A,{className:"animate-spin"}):"Generate Pattern"})]})})}),(0,a.jsx)(y,{value:"image",className:"mt-6",children:(0,a.jsx)(U,{...x,children:(0,a.jsxs)("form",{onSubmit:x.handleSubmit(O),className:"space-y-6",children:[(0,a.jsx)(G,{control:x.control,name:"image",render:e=>{let{field:{onChange:t,value:r,...s}}=e;return(0,a.jsxs)(B,{children:[(0,a.jsx)(Y,{className:"text-muted-foreground",children:"Upload Image"}),(0,a.jsx)(J,{children:(0,a.jsx)(g,{type:"file",accept:"image/*",onChange:e=>t(e.target.files),...s,className:"text-muted-foreground file:text-primary file:font-bold bg-input border-border file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-primary/20 hover:file:bg-primary/30"})}),(0,a.jsx)(H,{})]})}}),(0,a.jsx)(G,{control:x.control,name:"numValves",render:e=>{let{field:t}=e;return(0,a.jsxs)(B,{children:[(0,a.jsx)(Y,{className:"text-muted-foreground",children:"Number of Valves"}),(0,a.jsx)(J,{children:(0,a.jsx)(g,{type:"number",...t,className:"bg-input border-border focus:ring-primary",step:"8"})}),(0,a.jsx)(H,{})]})}}),(0,a.jsx)(h,{type:"submit",disabled:l,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground font-bold text-lg py-6",children:l?(0,a.jsx)(F.A,{className:"animate-spin"}):"Generate Pattern"})]})})}),(0,a.jsx)(y,{value:"svg",className:"mt-6",children:(0,a.jsx)(U,{...p,children:(0,a.jsxs)("form",{onSubmit:p.handleSubmit(z),className:"space-y-6",children:[(0,a.jsx)(G,{control:p.control,name:"svg",render:e=>{let{field:{onChange:t,value:r,...s}}=e;return(0,a.jsxs)(B,{children:[(0,a.jsx)(Y,{className:"text-muted-foreground",children:"Upload SVG"}),(0,a.jsx)(J,{children:(0,a.jsx)(g,{type:"file",accept:"image/svg+xml",onChange:e=>t(e.target.files),...s,className:"text-muted-foreground file:text-primary file:font-bold bg-input border-border file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-primary/20 hover:file:bg-primary/30"})}),(0,a.jsx)(H,{})]})}}),(0,a.jsx)(G,{control:p.control,name:"numValves",render:e=>{let{field:t}=e;return(0,a.jsxs)(B,{children:[(0,a.jsx)(Y,{className:"text-muted-foreground",children:"Number of Valves"}),(0,a.jsx)(J,{children:(0,a.jsx)(g,{type:"number",...t,className:"bg-input border-border focus:ring-primary",step:"8"})}),(0,a.jsx)(H,{})]})}}),(0,a.jsx)(h,{type:"submit",disabled:l,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground font-bold text-lg py-6",children:l?(0,a.jsx)(F.A,{className:"animate-spin"}):"Generate Pattern"})]})})}),(0,a.jsx)(y,{value:"manual",className:"mt-6",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-4 text-center p-8 border-2 border-dashed border-border/50 rounded-lg bg-card/50 h-full",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Create Your Own Pattern"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Use the grid editor to design a custom water curtain pattern from scratch."}),(0,a.jsx)(h,{onClick:()=>u(!0),className:"bg-primary hover:bg-primary/90 text-primary-foreground font-bold",children:"Open Manual Editor"})]})})]})})]}),(0,a.jsx)(ec,{isOpen:i,setIsOpen:u,addPattern:t,initialNumValves:f.getValues("numValves")})]})}var eh=r(2056);let eg=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsxs)(eh.bL,{ref:t,className:(0,x.cn)("relative flex w-full touch-none select-none items-center",r),...s,children:[(0,a.jsx)(eh.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,a.jsx)(eh.Q6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(eh.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});function eb(e){var t;let{patternData:r,speed:n=100,isPlaying:l,color:o="hsl(var(--primary))"}=e,i=(0,s.useRef)(null),d=(0,s.useRef)(),c=(0,s.useRef)(0),u=(0,s.useRef)(0),m=(0,s.useMemo)(()=>[...r].reverse(),[r]),f=r.length,x=(null==(t=r[0])?void 0:t.length)||0;if((0,s.useEffect)(()=>{let e,t,r=i.current;if(!r||!l||0===x||0===f){d.current&&cancelAnimationFrame(d.current);return}let a=r.getContext("2d");if(!a)return;let s=r.parentElement;if(s){let{width:e,height:t}=s.getBoundingClientRect();(r.width!==e||r.height!==t)&&(r.width=e,r.height=t)}let p=[],h=.1*r.width,g=r.width-h;x>1?(t=g/(x-1),e=h/2):(t=0,e=r.width/2);let b=s=>{if(a.clearRect(0,0,r.width,r.height),s-c.current>n){c.current=s;let r=m[u.current];r&&r.forEach((r,a)=>{r&&p.push({x:e+a*t,y:0,vy:4+2*Math.random(),len:15+5*Math.random(),opacity:1})}),u.current=(u.current+1)%f}let l=[];for(let e of(a.strokeStyle=o,a.lineWidth=2,a.lineCap="round",p))e.y+=e.vy,e.vy+=.3,e.opacity=Math.max(0,1-e.y/r.height),e.y<r.height&&(l.push(e),a.beginPath(),a.globalAlpha=e.opacity,a.moveTo(e.x,e.y),a.lineTo(e.x,e.y-e.len),a.stroke());p=l,a.globalAlpha=1,a.fillStyle=o;for(let r=0;r<x;r++){let s=e+r*t;a.beginPath(),a.arc(s,5,3,0,2*Math.PI),a.fill()}d.current=requestAnimationFrame(b)};return c.current=performance.now(),u.current=0,b(c.current),()=>{d.current&&cancelAnimationFrame(d.current)}},[l,m,n,f,x,o]),(0,s.useEffect)(()=>{u.current=0},[m]),0===f||0===x)return(0,a.jsx)("div",{className:"w-full h-full bg-transparent flex items-center justify-center text-muted-foreground text-xs",children:"No pattern data"});if(!l){let e=Math.max(1,f),t=Math.max(1,x);return(0,a.jsx)("div",{className:"w-full h-full grid p-1",style:{gridTemplateColumns:"repeat(".concat(t,", 1fr)"),gridTemplateRows:"repeat(".concat(e,", 1fr)"),gap:"1px"},children:r.map((e,t)=>(0,a.jsx)(s.Fragment,{children:e.map((e,r)=>(0,a.jsx)("div",{className:"min-w-0 min-h-0",style:{backgroundColor:e?o:"hsl(var(--border) / 0.1)",boxShadow:e?"0 0 1px ".concat(o):"none",borderRadius:"1px"}},"".concat(t,"-").concat(r)))},t))})}return(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)("canvas",{ref:i,className:"w-full h-full"})})}eg.displayName=eh.bL.displayName;var ev=r(3764),ej=r(3300);function eN(e){let{isOpen:t,setIsOpen:r,pattern:n}=e,[l,o]=(0,s.useState)(100),[i,d]=(0,s.useState)(!0),[c,u]=(0,s.useState)("#7DF9FF");return(0,a.jsx)(Q,{open:t,onOpenChange:r,children:(0,a.jsxs)(ee,{className:"max-w-2xl bg-background border-primary/30",children:[(0,a.jsxs)(et,{children:[(0,a.jsxs)(ea,{className:"text-primary font-headline text-2xl truncate",children:["Live Preview: ",n.name]}),(0,a.jsx)(es,{children:"Visualize the pattern, adjust its speed, and change the color."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 py-4",children:[(0,a.jsx)("div",{className:"aspect-video bg-card/50 rounded-lg p-4 border border-border flex items-center justify-center",children:(0,a.jsx)(eb,{patternData:n.patternData,speed:l,isPlaying:i,color:c})}),(0,a.jsxs)("div",{className:"grid gap-4 pt-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(L,{htmlFor:"speed",className:"text-muted-foreground",children:"Animation Speed"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("span",{className:"text-sm text-foreground",children:"Slow"}),(0,a.jsx)(eg,{id:"speed",min:20,max:500,step:10,value:[520-l],onValueChange:e=>o(520-e[0]),className:"[&>span:first-child>span]:bg-accent"}),(0,a.jsx)("span",{className:"text-sm text-foreground",children:"Fast"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-8 pt-4",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)(L,{className:"text-muted-foreground",children:"Playback"}),(0,a.jsx)(h,{variant:"outline",size:"icon",onClick:()=>d(!i),className:"h-12 w-12 rounded-full border-accent text-accent hover:bg-accent/20 hover:text-accent","aria-label":i?"Pause":"Play",children:i?(0,a.jsx)(ev.A,{className:"h-6 w-6"}):(0,a.jsx)(ej.A,{className:"h-6 w-6"})})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)(L,{htmlFor:"color-picker",className:"text-muted-foreground",children:"Color"}),(0,a.jsx)(g,{id:"color-picker",type:"color",value:c,onChange:e=>u(e.target.value),className:"w-12 h-12 p-1 bg-transparent border-border rounded-full cursor-pointer"})]})]})]})]}),(0,a.jsx)(er,{children:(0,a.jsx)(h,{onClick:()=>r(!1),variant:"outline",className:"border-accent text-accent hover:bg-accent/20 hover:text-accent",children:"Close"})})]})})}var ey=r(7223);function ew(e){let{pattern:t,deletePattern:r}=e,[n,l]=(0,s.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(R,{className:"h-full flex flex-col justify-between bg-card border-border hover:border-primary transition-colors shadow-xl shadow-black/25",children:[(0,a.jsxs)(D,{className:"relative",children:[(0,a.jsx)(M,{className:"flex items-start justify-between",children:(0,a.jsx)("span",{className:"truncate text-base font-semibold text-foreground pr-8",children:t.name})}),(0,a.jsxs)(h,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-7 w-7 text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>r(t.id),children:[(0,a.jsx)(ey.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Delete pattern"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground pt-1",children:[(()=>{switch(t.source){case"image":return(0,a.jsx)(k.A,{className:"h-4 w-4"});case"svg":return(0,a.jsx)(E.A,{className:"h-4 w-4"});case"manual":return(0,a.jsx)(P.A,{className:"h-4 w-4"});default:return(0,a.jsx)(A.A,{className:"h-4 w-4"})}})(),(0,a.jsx)("span",{className:"capitalize",children:t.source})]})]}),(0,a.jsx)(I,{className:"flex-grow flex items-center justify-center p-2",children:(0,a.jsx)("div",{className:"w-full aspect-square bg-background/50 rounded-md overflow-hidden border border-border",children:(0,a.jsx)(eb,{patternData:t.patternData,isPlaying:!1})})}),(0,a.jsx)(T,{className:"p-4",children:(0,a.jsx)(h,{onClick:()=>l(!0),className:"w-full",variant:"outline",children:"Live Preview"})})]}),(0,a.jsx)(eN,{isOpen:n,setIsOpen:l,pattern:t})]})}var eC=r(295);function eS(e){let{patterns:t,onDragStart:r,onDragOver:s,onDrop:n,deletePattern:l}=e;return 0===t.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full rounded-lg border-2 border-dashed border-border/50 p-12 text-center bg-card/50",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-foreground font-headline",children:"Your Pattern Sequence"}),(0,a.jsx)("p",{className:"mt-2 text-muted-foreground",children:"Generate patterns from text or an image to start building your water curtain show."}),(0,a.jsx)("p",{className:"mt-4 text-sm text-muted-foreground/50",children:"Your generated patterns will appear here. You can drag and drop to reorder them."})]}):(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-foreground font-headline",children:"Pattern Sequence"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:t.map(e=>(0,a.jsxs)("div",{draggable:!0,onDragStart:()=>r(e),onDragOver:s,onDrop:()=>n(e),className:"relative group cursor-grab active:cursor-grabbing outline-none focus-visible:ring-2 focus-visible:ring-ring rounded-lg",children:[(0,a.jsx)("div",{className:"absolute top-1/2 -left-3 -translate-y-1/2 z-10 text-primary/50 opacity-0 group-hover:opacity-100 transition-opacity motion-safe:animate-pulse",children:(0,a.jsx)(eC.A,{})}),(0,a.jsx)(ew,{pattern:e,deletePattern:l})]},e.id))})]})}var eA=r(442),ek=r(6013),eE=r(6609),eP=r(9829),eF=r(7607),eR=r(2278);let eD=eR.bL,eM=eR.l9,eV=eR.ZL,eI=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(eR.hJ,{className:(0,x.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s,ref:t})});eI.displayName=eR.hJ.displayName;let eT=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsxs)(eV,{children:[(0,a.jsx)(eI,{}),(0,a.jsx)(eR.UC,{ref:t,className:(0,x.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...s})]})});eT.displayName=eR.UC.displayName;let eO=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,x.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...r})};eO.displayName="AlertDialogHeader";let ez=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,x.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})};ez.displayName="AlertDialogFooter";let eL=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(eR.hE,{ref:t,className:(0,x.cn)("text-lg font-semibold",r),...s})});eL.displayName=eR.hE.displayName;let eU=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(eR.VY,{ref:t,className:(0,x.cn)("text-sm text-muted-foreground",r),...s})});eU.displayName=eR.VY.displayName;let e_=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(eR.rc,{ref:t,className:(0,x.cn)(p(),r),...s})});e_.displayName=eR.rc.displayName;let eG=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(eR.ZD,{ref:t,className:(0,x.cn)(p({variant:"outline"}),"mt-2 sm:mt-0",r),...s})});function eW(e){let{ipAddress:t,setIpAddress:r,isConnected:n,handleConnect:l,sendCommand:o,isUploading:i,handleUploadSequence:d}=e,[c,u]=(0,s.useState)(100),[m,f]=(0,s.useState)("#7DF9FF"),[x,p]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{n?o({action:"color",value:m}):p(!1)},[n]),(0,a.jsxs)(R,{className:"bg-card border-border shadow-2xl shadow-black/25",children:[(0,a.jsxs)(D,{children:[(0,a.jsxs)(M,{className:"flex items-center justify-between text-primary font-headline",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eA.A,{className:"h-6 w-6"}),"Hardware Controls"]}),n&&(0,a.jsxs)(eD,{children:[(0,a.jsx)(eM,{asChild:!0,children:(0,a.jsx)(h,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",children:(0,a.jsx)(ek.A,{className:"h-5 w-5"})})}),(0,a.jsxs)(eT,{children:[(0,a.jsxs)(eO,{children:[(0,a.jsx)(eL,{children:"Reconfigure Device?"}),(0,a.jsx)(eU,{children:'This will reboot the device into Access Point (AP) mode. You will be disconnected and will need to connect to the "DigitalWaterCurtain-Setup" WiFi network to reconfigure it. Are you sure?'})]}),(0,a.jsxs)(ez,{children:[(0,a.jsx)(eG,{children:"Cancel"}),(0,a.jsx)(e_,{onClick:()=>{o({action:"reboot_to_ap"})},children:"Reboot to AP Mode"})]})]})]})]}),(0,a.jsx)(V,{children:"Connect to and control your physical water curtain."})]}),(0,a.jsxs)(I,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L,{htmlFor:"ip-address",children:"ESP32 IP Address"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(g,{id:"ip-address",value:t,onChange:e=>r(e.target.value),placeholder:"e.g., 192.168.4.1",className:"bg-input border-border",disabled:n}),(0,a.jsx)(h,{onClick:l,variant:n?"destructive":"default",className:"w-[120px]",children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eE.A,{})," Disconnect"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eP.A,{})," Connect"]})})]}),(0,a.jsx)("p",{className:"text-xs pl-1 text-muted-foreground",children:'In setup mode, connect to "DigitalWaterCurtain-Setup" WiFi and use IP 192.168.4.1.'})]}),(0,a.jsxs)("div",{className:"space-y-6 transition-opacity ".concat(n?"opacity-100":"opacity-50 pointer-events-none"),children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L,{htmlFor:"speed",children:"Animation Speed"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("span",{className:"text-sm text-foreground",children:"Slow"}),(0,a.jsx)(eg,{id:"speed",min:20,max:500,step:10,value:[520-c],onValueChange:e=>{let t=520-e[0];u(t),o({action:"speed",value:t})},className:"[&>span:first-child>span]:bg-accent"}),(0,a.jsx)("span",{className:"text-sm text-foreground",children:"Fast"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-around gap-4 pt-2",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)(L,{className:"text-muted-foreground",children:"Playback"}),(0,a.jsx)(h,{variant:"outline",size:"icon",onClick:()=>{let e=!x;o({action:e?"play":"pause"})&&p(e)},className:"h-12 w-12 rounded-full border-accent text-accent hover:bg-accent/20 hover:text-accent","aria-label":x?"Pause":"Play",children:x?(0,a.jsx)(ev.A,{className:"h-6 w-6"}):(0,a.jsx)(ej.A,{className:"h-6 w-6"})})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)(L,{htmlFor:"color-picker",className:"text-muted-foreground",children:"LED Color"}),(0,a.jsx)(g,{id:"color-picker",type:"color",value:m,onChange:e=>{f(e.target.value),o({action:"color",value:e.target.value})},className:"w-12 h-12 p-1 bg-transparent border-border rounded-full cursor-pointer"})]})]}),(0,a.jsxs)(h,{onClick:d,className:"w-full bg-accent hover:bg-accent/80 text-black font-bold text-lg py-6",disabled:i,children:[(0,a.jsx)(eF.A,{className:"mr-2"}),i?"Uploading...":"Upload Sequence to Curtain"]})]})]})]})}function eq(){let[e,t]=(0,s.useState)([]),[r,n]=(0,s.useState)(null),[l,o]=(0,s.useState)("192.168.4.1"),[d,c]=(0,s.useState)(!1),[u,m]=(0,s.useState)(!1),f=(0,s.useRef)(null),{toast:x}=(0,C.dj)();(0,s.useEffect)(()=>()=>{var e;null==(e=f.current)||e.close()},[]);let p=e=>{var t;return(null==(t=f.current)?void 0:t.readyState)===WebSocket.OPEN?(f.current.send(JSON.stringify(e)),!0):(x({variant:"destructive",title:"Not Connected",description:"Connect to the hardware first."}),!1)};return(0,a.jsxs)("div",{className:"flex min-h-screen w-full flex-col bg-background relative pb-16",children:[(0,a.jsx)(i,{isConnected:d}),(0,a.jsxs)("main",{className:"flex flex-1 flex-col xl:flex-row gap-8 p-4 md:p-8",children:[(0,a.jsxs)("div",{className:"w-full xl:w-[420px] xl:max-w-[420px] flex-shrink-0 flex flex-col gap-8",children:[(0,a.jsx)(ep,{addPattern:e=>{t(t=>[...t,{...e,id:crypto.randomUUID()}])}}),(0,a.jsx)(eW,{ipAddress:l,setIpAddress:o,isConnected:d,handleConnect:()=>{if(f.current&&f.current.readyState===WebSocket.OPEN)return void f.current.close();if(!l)return void x({variant:"destructive",title:"Error",description:"Please enter the ESP32 IP address."});let e=l||"192.168.4.1";f.current=new WebSocket("ws://".concat(e,"/ws")),f.current.onopen=()=>{console.log("WebSocket Connected"),c(!0),x({title:"Success",description:"Connected to Digital Water Curtain hardware!"})},f.current.onclose=()=>{console.log("WebSocket Disconnected"),c(!1),x({variant:"destructive",title:"Disconnected",description:"Connection to hardware lost."})},f.current.onerror=t=>{console.error("WebSocket Error:",t),c(!1),x({variant:"destructive",title:"Connection Failed",description:"Could not connect to ".concat(e,". Check IP and network.")})}},sendCommand:p,isUploading:u,handleUploadSequence:()=>{var t,r;if(0===e.length)return void x({variant:"destructive",title:"Empty Sequence",description:"Generate some patterns before uploading."});m(!0);let a=(null==(r=e[0])||null==(t=r.patternData[0])?void 0:t.length)||0;if(0===a){x({variant:"destructive",title:"Invalid Pattern",description:"Cannot upload a pattern with zero valves."}),m(!1);return}if(!p({action:"config",valves:a,leds:a}))return void m(!1);setTimeout(()=>{p({action:"load_pattern",pattern:e.flatMap(e=>e.patternData)}),x({title:"Sequence Uploaded",description:"Sent ".concat(e.length," patterns (").concat(a," valves) to the hardware.")}),p({action:"pause"}),setTimeout(()=>m(!1),500)},200)}})]}),(0,a.jsx)("div",{className:"w-full flex-1",children:(0,a.jsx)(eS,{patterns:e,onDragStart:e=>{n(e)},onDragOver:e=>{e.preventDefault()},onDrop:a=>{if(!r||r.id===a.id)return;let s=e.findIndex(e=>e.id===r.id),l=e.findIndex(e=>e.id===a.id);-1!==s&&-1!==l&&t(e=>{let t=[...e],[r]=t.splice(s,1);return t.splice(l,0,r),t}),n(null)},deletePattern:e=>{t(t=>t.filter(t=>t.id!==e))}})})]}),(0,a.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 p-2 text-center bg-card/80 backdrop-blur-sm border-t border-border/50 shadow-lg",children:(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Digital Water Curtain Developed By ",(0,a.jsx)("strong",{children:"JA3Jou3"})," And ",(0,a.jsx)("strong",{children:"Ehsen"})]})})]})}eG.displayName=eR.ZD.displayName},9434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var a=r(2596),s=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[222,670,441,684,358],()=>t(2751)),_N_E=e.O()}]);